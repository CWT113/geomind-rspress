# 坐标系统

## 坐标系分类

Cesium 中常用的坐标有两种 WGS84 地理坐标系、笛卡尔空间坐标系、场景坐标。

### WGS84 坐标

WGS84 地理坐标系包括：

- **WGS84 经纬度坐标系**（没有实际的对象）
- **WGS84 弧度坐标系**（Cartographic）

> Cesium 目前支持两种坐标系 WGS84 和 WebMercator，但是在 Cesium 中没有实际的对象来描述 WGS84 坐标，都是以弧度的方式来进行运用的。

### 笛卡尔空间坐标系

笛卡尔空间坐标系包括：

- **平面坐标系**（Cartesian2）
- **笛卡尔空间直角坐标系**（Cartesian3）
- **4D 笛卡尔坐标系**（Cartesian4）

>笛卡尔空间坐标的原点就是 **椭球的中心**。这里的 Cartesian3 有点类似于 Point3D 对象。

### 场景坐标

场景坐标即屏幕像素坐标，二维屏幕坐标系，[x, y] (单位: 像素)。



## 坐标转换

### 经纬度 ⇆ 笛卡尔

```typescript
// WGS84经纬度 → 笛卡尔坐标
const cartesian = Cesium.Cartesian3.fromDegrees(longitude, latitude, height);

// 笛卡尔坐标 → WGS84弧度
const cartographic = Cesium.Cartographic.fromCartesian(cartesian);
const cartographic = Cesium.Ellipsoid.WGS84.cartesianToCartographic(
  cartesian, 
  new Cesium.Cartographic()
);

// WGS84弧度 → WGS84经纬度
const longitude = Cesium.Math.toDegrees(cartographic.longitude);
const latitude = Cesium.Math.toDegrees(cartographic.latitude);
const height = cartographic.height;
// 算数方法
const longitude = (180 / Math.PI) * cartographic.longitude;
const latitude = (180 / Math.PI) * cartographic.latitude;
```



### 角度 ⇆ 弧度

```typescript
// 角度 → 弧度
const radians = Cesium.Math.toRadians(degrees);

// 弧度 → 角度
const degrees = Cesium.Math.toDegrees(radians);
```



### 屏幕坐标 ⇆ 场景坐标

```typescript
// 屏幕坐标 → 场景坐标(世界坐标)
const pickedObject = viewer.scene.pick(windowPosition);
if (Cesium.defined(pickedObject)) {
  const cartesian = viewer.scene.pickPosition(windowPosition);
}

// 场景坐标 → 屏幕坐标
const screenPosition = Cesium.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene, cartesian);
```



## 坐标工具函数

### 计算两点距离

```typescript
// 计算平面距离
const position1 = Cesium.Cartesian3.fromDegrees(102.735226, 38.027134, 0);
const position2 = Cesium.Cartesian3.fromDegrees(102.736253, 38.024079, 0);
const distance = Cesium.Cartesian3.distance(position1, position2);

// 或者计算地表距离
const geodesic = new Cesium.EllipsoidGeodesic();
geodesic.setEndPoints(
  Cesium.Cartographic.fromCartesian(position1),
  Cesium.Cartographic.fromCartesian(position2),
);
const surfaceDistance = geodesic.surfaceDistance;
```



### 计算方位角

```typescript
const position = Cesium.Cartesian3.fromDegrees(114, 30, 0);
const angleRad = Cesium.Cartesian3.angleBetween(
  Cesium.Cartesian3.UNIT_Y, // Y轴正方向
  Cesium.Cartesian3.normalize(position, new Cesium.Cartesian3()), // 归一化参数向量
);
const heading = Cesium.Math.toDegrees(angleRad);
```



### 坐标线性插值

```typescript
const startPosition = Cesium.Cartesian3.fromDegrees(102.735226, 38.027134, 0);
const endPosition = Cesium.Cartesian3.fromDegrees(102.736253, 38.024079, 0);

// 线性插值，返回的是笛卡尔坐标
const interpolated = Cesium.Cartesian3.lerp(
  startPosition,
  endPosition,
  0.5, // 插值系数 [0,1]，0表示开始点插值，0.5表示中间位置插值，1表示结束位置插值
  new Cesium.Cartesian3()
);

// 球面线性插值
const interpolated = Cesium.Cartesian3.slerp(
  startPosition,
  endPosition,
  t,
  new Cesium.Cartesian3()
);
```
